<!DOCTYPE html>
<html>
<head>
    <title>咨询策划中心工作任务清单</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/minimal.css" rel="stylesheet" media="screen">
    <!-- <link href="css/todc-bootstrap.css" rel="stylesheet" media="screen"> -->
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
    <link href="css/index.css" rel="stylesheet" media="screen">
    <script src="js/jquery-1.7.1.js"></script>
    <script src="js/jquery.icheck.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/knockout-2.3.0.js"></script>
</head>
<body>
<div class="container">
<div class="masthead">
    <ul class="pull-right unstyled inline header-info">
        <li>
            <a class="text-info" href="#"><i class="icon-user"></i> User</a>
        </li>
        <li>
            <a class="text-info" href="#"><i class="icon-off"></i> 退出</a>
        </li>
        <!--<li>
            <div class="btn-group">
                <div class="input-append">
                    <input class="span2" id="appendedInputButtons" type="text">
                    <a class="btn" href="#"><i class="icon-search"></i></a>
                </div>
            </div>
        </li>-->
    </ul>
    <h3 class="muted">Project Name</h3>
</div>
<div class="row">
    <div class="span12">
        <div class="btn-group pull-right">
            <div class="input-append input-append-search">
                <input class="input-xlarge" id="appendedInputButtons" type="text">
                <a class="btn" href="#"><i class="icon-search"></i></a>
            </div>
        </div>
        <ul class="nav nav-tabs">
            <li class="active"><a href="#">任务清单</a></li>
            <li><a href="#">工作日志</a></li>
        </ul>
    </div>

</div>

<div id="taskList" class="row">
<div class="span2">
    <ul class="nav nav-list">
        <li>
            <button data-bind="click: showEditView" class="btn btn-danger btn-new">发布任务</button>
        </li>
        <!-- ko foreach: { data: taskList.filterLinks, as: 'filterLink' } -->
        <li class="nav-header"><h5 data-bind="text: name"></h5>
        <li data-bind="if: value"><a data-bind="click: clear" href="javascript:void(0);"><i
                class="icon-minus"></i><span class="text-success">全部</span></a></li>
        <li>
            <ul data-bind="foreach: { data: selectListItems, as: 'item' }" class="nav nav-list">
                <li data-bind="attr: { class: filterLink.value() == item.value ? 'active' : ''}">
                    <a data-bind="text: item.name, click: filterLink.select" class="" href="#"></a>
                </li>
            </ul>
        </li>
        <!-- /ko -->
    </ul>
</div>

<div id="list" class="span10">
    <div class="row">
        <div class="span5">
            <ul class="inline">
                <li>
                    <div class="btn-group">
                        <a href="#" class="btn dropdown-toggle" data-toggle="dropdown">
                            <div class="btn-checkbox"><input type="checkbox">
                            </div>
                            <span class="caret pull-right"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">全选</a></li>
                            <li><a href="#">全不选</a></li>
                        </ul>
                    </div>

                    <div class="btn-group item-action">
                        <a class="btn btn-action" title="删除"><i class="icon-trash"></i></a>
                    </div>
                    <div class="btn-group item-action">
                        <a class="btn dropdown-toggle btn-action" data-toggle="dropdown" title="标记"><i
                                class="icon-tags"></i><span
                                class="caret pull-right"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#"><i class="icon-ok"></i> 标记为完成</a></li>
                            <li><a href="#"><i class="icon-off"></i> 标记为取消</a></li>
                        </ul>
                    </div>
                    <div class="btn-group">
                        <a class="btn btn-action" title="下载"><i class="icon-download-alt"></i></a>
                    </div>
                </li>
            </ul>
            <!--<div class="navbar">
            </div>-->
        </div>
        <div class="span5">
            <ul class="pull-right inline">
                <li>
                <span>
                    第
                    <strong>1-20</strong>
                    项，共
                    <strong>55</strong>
                    项
                </span>
                </li>
                <li>
                    <div class="btn-group">
                        <a class="btn"><i class="icon-chevron-left"></i></a>
                        <a class="btn"><i class="icon-chevron-right"></i></a>
                    </div>
                    <div class="btn-group">
                        <a class="btn"><i class="icon-refresh"></i></a>
                    </div>
                    <!--<div class="btn-group">
                        <a class="btn"><i class="icon-cog"></i></a>
                    </div>-->
                </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="span10">
            <table class="table table-hover">
                <colgroup>
                    <col style="width: 40px;">
                    <col style="width: 100px;">
                    <col style="width: 150px;">
                    <col style="width: 80px;">
                    <col style="width: 250px;">
                </colgroup>
                <tbody data-bind="foreach: taskList.list">
                <tr data-bind="click: $root.showEditView">
                    <td>
                        <input type="checkbox">
                    </td>
                    <td>
                        <strong data-bind="text: daySpan, attr: {class: daySpanClass}">
                        </strong>
                        <small>天</small>
                        <br>
                        <small data-bind="text: deadline" class="muted"></small>
                    </td>
                    <td><h5 data-bind="text: taskName">自动部署工具</h5></td>
                </tr>
                <!--<tr data-bind="click: showEditView">
                    <td>
                        <input type="checkbox">
                    </td>
                    <td>
                        <p>
                            <strong class="timespan-day">2
                            </strong>
                            <small>天</small>
                        </p>
                        <small class="muted">2013年4月4日</small>
                    </td>
                    <td><h5>自动部署工具</h5></td>
                    <td><h5>负责人</h5></td>
                    <td>
                        <div style="overflow: hidden;">
                            系统管理员经常陷入一系列的重复任务中：如升级软件包、管理配置文件、系统服务、cron任务以及添加新的配置、修复错误等。这些任务通常是重复低
                            效的，解决这类任务的第一反应是让他们自动化，于是出现了定制脚本。由于环境复杂，定制脚本和应用程序一再被重复开发，并且很难适合多种平台，灵活性和功
                            能也很难保证，于是像Puppet这样的自动化配置管理工具便出现了
                        </div>
                    </td>
                </tr>-->
                </tbody>
            </table>
        </div>
    </div>
</div>
<div id="edit" class="span10" style="display: none">
    <div class="row">
        <div class="span5">
            <ul class="inline">
                <li>
                    <div class="btn-group">
                        <a data-bind="click: showListView" class="btn btn-action" title="返回"><i
                                class="icon-arrow-left"></i></a>
                    </div>
                    <div class="btn-group item-action">
                        <a class="btn btn-action" title="保存"><i class="icon-ok"></i></a>
                        <a class="btn btn-action" title="删除"><i class="icon-trash"></i></a>
                    </div>
                    <div class="btn-group item-action">
                        <a class="btn dropdown-toggle btn-action" data-toggle="dropdown" title="标记"><i
                                class="icon-tags"></i> <span
                                class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#"><i class="icon-ok"></i> 标记为完成</a></li>
                            <li><a href="#"><i class="icon-off"></i> 标记为取消</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
            <!--<div class="navbar">
            </div>-->
        </div>
        <!--<div class="span5">
            <ul class="pull-right inline">
                <li>
                <span>
                    第
                    <strong>10</strong>
                    项，共
                    <strong>55</strong>
                    项
                </span>
                </li>
                <li>
                    <div class="btn-group">
                        <a class="btn"><i class="icon-chevron-left"></i></a>
                        <a class="btn"><i class="icon-chevron-right"></i></a>
                    </div>
                    &lt;!&ndash;<div class="btn-group">
                        <a class="btn"><i class="icon-cog"></i></a>
                    </div>&ndash;&gt;
                </li>
            </ul>
        </div>-->
    </div>
    <hr class="edit-hr">
    <div class="well">
        <form class="form-horizontal">
            <div class="control-group">
                <label class="control-label" for="taskName">项目名称：</label>

                <div class="controls">
                    <input type="text" class="input-xxlarge" id="taskName">
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="description">项目说明：</label>

                <div class="controls">
                    <textarea id="description" class="input-xxlarge" rows="3"></textarea>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="participants">参与人：</label>

                <div class="controls">
                    <textarea id="participants" class="input-xxlarge" rows="3"></textarea>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="price">项目金额：</label>

                <div class="controls">
                    <div class="input-prepend input-append">
                        <span class="add-on">￥</span>
                        <input class="span2" id="price" type="text">
                        <span class="add-on">.00</span>
                    </div>
                </div>
            </div>
            <div class="control-group">
                <label class="control-label" for="expiredTime">过期时间：</label>

                <div class="controls">
                    <input type="text" id="expiredTime">
                </div>
            </div>
        </form>
    </div>
</div>
</div>
</div>
<script>
    $(document).ready(function () {
        $('input').iCheck({
            checkboxClass: 'icheckbox_minimal'
        });
    });

    function loadTasks() {
        var daySpans = [0, 1, 2, 2, 3, 5, 6, 10, 15, 26, 30, 31, 32, 38, 40, 80, 100, 130, 400, 430];
        var data = [];
        var now;
        for (var i = 0; i < daySpans.length; i++) {
            now = new Date();
            now.setDate(now.getDate() - daySpans[i])
            data.push(new taskViewModel({
                Deadline: now,
                TaskName: "自动部署工具自动部署工具自动部署工具自动部署工具",
                PersonInCharge: "负责人",
                Creator: "用户",
                CreateTime: new Date(2013, 5, 1)
            }));
        }
        return data;
    }

    function formatDate(date) {
        return  date.getYear() + "年" + date.getMonth() + "月" + date.getDay() + "日"
    }

    var filterLinkViewModel = function (field, name, selectListItems, defaultValue) {
        var self = this;
        self.field = field;
        self.name = name;
        self.selectListItems = selectListItems;
        self.value = ko.observable(defaultValue);
        self.select = function (data) {
            self.value(data.value);
        };
        self.clear = function () {
            self.value("");
        }
    };

    var taskListViewModel = function () {
        var self = this;
        self.filterLinks = ko.observableArray([
            new filterLinkViewModel("Status", "任务状态", [
                {value: "1", name: "未完成"},
                {value: "2", name: "已完成"},
                {value: "3", name: "已取消"},
                {value: "4", name: "发布待审"},
                {value: "5", name: "完成待审"}
            ], "1"),
            new filterLinkViewModel("Deadline", "到期时间", [
                {value: "1", name: "三天内"},
                {value: "2", name: "一周内"},
                {value: "3", name: "一个月内"}
            ], "1"),
            new filterLinkViewModel("TaskType", "任务类型", [
                {value: "1", name: "我负责的"},
                {value: "2", name: "我参与的"}
            ], "")
        ]);
        self.list = ko.observableArray(loadTasks());
        self.paginationInfo = ko.observable(new paginationInfo(1, 20, 0));
    };

    var paginationInfo = function (pageIndex, pageSize, total) {
        var self = this;
        self.pageIndex = pageIndex;
        self.pageSize = pageSize;
        self.total = total;
    };

    var taskViewModel = function (task) {
        this.deadline = formatDate(task.Deadline);
        this.taskName = task.TaskName;
        this.personInCharge = task.PersonInCharge;
        this.creator = task.Creator;
        this.createTime = formatDate(task.CreateTime);
        this.daySpan = parseInt(Math.abs(task.Deadline - Date()) / 1000 / 60 / 60 / 24);
        if (this.daySpan <= 3) {
            this.daySpanClass = "timespan-day";
        } else if (this.daySpan <= 7) {
            this.daySpanClass = "timespan-week";
        } else if (this.daySpan <= 30) {
            this.daySpanClass = "timespan-month";
        } else {
            this.daySpanClass = "timespan";
        }
        return this;
    };

    var indexViewModel = function () {
        var self = this;
        self.taskList = new taskListViewModel();
        self.showEditView = function () {
            $("#list").hide();
            $("#edit").show();
        };
        self.showListView = function () {
            $("#list").show();
            $("#edit").hide();
        };
    };
    ko.applyBindings(new indexViewModel());

</script>
</body>
</html>