<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <title>咨询策划中心工作任务清单</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/minimal.css" rel="stylesheet" media="screen">
    <!-- <link href="css/todc-bootstrap.css" rel="stylesheet" media="screen"> -->
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
    <link href="css/index.css" rel="stylesheet" media="screen">
    <link href="css/datetimepicker.css" rel="stylesheet" media="screen">
    <script type="text/javascript" src="js/jquery-1.7.1.js"></script>
    <script type="text/javascript" src="js/jquery.icheck.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/knockout-2.3.0.js"></script>
    <script type="text/javascript" src="js/bootstrap-datetimepicker.js"></script>
    <script type="text/javascript" src="js/locales/bootstrap-datetimepicker.zh-CN.js"></script>
</head>
<body>
<div class="container">
<div class="masthead">
    <ul class="pull-right unstyled inline header-info">
        <li>
            <a class="text-info" href="#"><i class="icon-user"></i> User</a>
        </li>
        <li>
            <a class="text-info" href="#"><i class="icon-off"></i> 退出</a>
        </li>
        <!--<li>
            <div class="btn-group">
                <div class="input-append">
                    <input class="span2" id="appendedInputButtons" type="text">
                    <a class="btn" href="#"><i class="icon-search"></i></a>
                </div>
            </div>
        </li>-->
    </ul>
    <h3 class="muted">Project Name</h3>
</div>
<div class="row">
<div class="span12">
<div class="btn-group pull-right">
    <div class="input-append input-append-search">
        <input class="input-xlarge" id="appendedInputButtons" type="text">
        <a class="btn" href="#"><i class="icon-search"></i></a>
    </div>
</div>
<ul id="mainTab" class="nav nav-tabs">
    <li class="active"><a href="#taskList" data-toggle="tab">任务清单</a></li>
    <li><a href="#nodeList" data-toggle="tab">工作日志</a></li>
</ul>
<div id="mainTabContent" class="row tab-content">
<div class="tab-pane fade active in" id="taskList">
<div class="span2">
    <ul class="nav nav-list">
        <li>
            <button data-bind="click: showEditView" class="btn btn-danger btn-new">发布任务</button>
        </li>
        <!-- ko foreach: { data: taskList.filterLinks, as: 'filterLink' } -->
        <li class="nav-header"><h5 data-bind="text: name"></h5>
        <li data-bind="if: value"><a data-bind="click: clear" href="javascript:void(0);"><i
                class="icon-minus"></i><span class="text-success">全部</span></a></li>
        <li>
            <ul data-bind="foreach: { data: selectListItems, as: 'item' }" class="nav nav-list">
                <li data-bind="attr: { 'class': filterLink.value() == item.value ? 'active' : ''}">
                    <a data-bind="text: item.name, click: filterLink.select" class="" href="#"></a>
                </li>
            </ul>
        </li>
        <!-- /ko -->
    </ul>
</div>
<div id="list" class="span10">
    <div class="row">
        <div class="span5">
            <ul class="inline">
                <li>
                    <div class="btn-group">
                        <a href="#" class="btn dropdown-toggle" data-toggle="dropdown">
                            <div class="btn-checkbox"><input type="checkbox">
                            </div>
                            <span class="caret pull-right"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">全选</a></li>
                            <li><a href="#">全不选</a></li>
                        </ul>
                    </div>

                    <div class="btn-group item-action">
                        <a class="btn btn-action" title="删除"><i class="icon-trash"></i></a>
                    </div>
                    <div class="btn-group item-action">
                        <a class="btn dropdown-toggle btn-action" data-toggle="dropdown" title="标记"><i
                                class="icon-tags"></i><span
                                class="caret pull-right"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#"><i class="icon-ok"></i> 标记为完成</a></li>
                            <li><a href="#"><i class="icon-off"></i> 标记为取消</a></li>
                        </ul>
                    </div>
                    <div class="btn-group">
                        <a class="btn btn-action" title="下载"><i class="icon-download-alt"></i></a>
                    </div>
                </li>
            </ul>
            <!--<div class="navbar">
            </div>-->
        </div>
        <div class="span5">
            <ul class="pull-right inline">
                <li>
                            <span>
                                第
                                <strong>1-20</strong>
                                项，共
                                <strong>55</strong>
                                项
                            </span>
                </li>
                <li>
                    <div class="btn-group">
                        <a class="btn"><i class="icon-chevron-left"></i></a>
                        <a class="btn"><i class="icon-chevron-right"></i></a>
                    </div>
                    <div class="btn-group">
                        <a class="btn"><i class="icon-refresh"></i></a>
                    </div>
                    <!--<div class="btn-group">
                        <a class="btn"><i class="icon-cog"></i></a>
                    </div>-->
                </li>
            </ul>
        </div>
    </div>
    <div class="row">
        <div class="span10">
            <table class="table table-hover list-table">
                <colgroup>
                    <col style="width: 50px;">
                    <col style="width: 120px;">
                    <col style="width: 350px;">
                    <col style="width: 200px;">
                </colgroup>
                <tbody data-bind="foreach: taskList.list">
                <tr data-bind="click: $root.showEditView">
                    <td>
                        <input type="checkbox">
                    </td>
                    <td>
                        <span data-bind="html: daySpanHtml"></span>
                        <br>
                        <small data-bind="text: deadline" class="muted"></small>
                    </td>
                    <td><h5 data-bind="text: taskName"></h5></td>
                    <td>
                        <div style="text-align: center;"><span data-bind="text: personInCharge"></span></div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<div id="edit" class="span10" style="display: none">
    <div class="row">
        <div class="span5">
            <ul class="inline">
                <li>
                    <div class="btn-group">
                        <a data-bind="click: showListView" class="btn btn-action" title="返回"><i
                                class="icon-arrow-left"></i></a>
                    </div>
                    <div class="btn-group item-action">
                        <a class="btn btn-action" data-toggle="tooltip" data-placement="bottom" title="保存"><i
                                class="icon-ok"></i></a>
                        <a class="btn btn-action" data-toggle="tooltip" title="删除"><i class="icon-trash"></i></a>
                    </div>
                    <div class="btn-group item-action">
                        <a class="btn dropdown-toggle btn-action" data-toggle="dropdown" title="标记"><i
                                class="icon-tags"></i> <span
                                class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#"><i class="icon-ok"></i> 标记为完成</a></li>
                            <li><a href="#"><i class="icon-off"></i> 标记为取消</a></li>
                        </ul>
                    </div>
                </li>
            </ul>
            <!--<div class="navbar">
            </div>-->
        </div>
    </div>
    <hr class="edit-hr">
    <div class="row">
        <div class="span10">
            <ul id="myTab" class="nav nav-tabs">
                <li class="active"><a href="#info" data-toggle="tab">基本信息</a></li>
                <li class=""><a href="#attachment" data-toggle="tab">附件</a></li>
                <li class=""><a href="#comment" data-toggle="tab">评论</a></li>
            </ul>
            <div id="myTabContent" class="tab-content">
                <div class="tab-pane fade active in" id="info">
                    <form class="form-horizontal">
                        <div class="control-group">
                            <label class="control-label">项目类型：</label>

                            <div class="controls">
                                <select>
                                    <option>纵向研究</option>
                                    <option>横向研究</option>
                                    <option>横向咨询</option>
                                    <option>纵向工作</option>
                                    <option>中心工作</option>
                                </select>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="taskName">项目名称：</label>

                            <div class="controls">
                                <input type="text" class="input-xxlarge" id="taskName">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="description">委托单位：</label>

                            <div class="controls">
                                <input id="description" type="text" class="input-xxlarge">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">开始时间：</label>

                            <div class="controls">
                                <div class="input-append date form_datetime">
                                    <input size="16" type="text" value="">
                                    <span class="add-on"><i class="icon-remove"></i></span>
                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">截止时间：</label>

                            <div class="controls">
                                <div class="input-append date form_datetime">
                                    <input size="16" type="text" value="">
                                    <span class="add-on"><i class="icon-remove"></i></span>
                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">需完成的材料：</label>

                            <div class="controls">
                                <textarea class="input-xxlarge" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">具体进展：</label>

                            <div class="controls">
                                <textarea class="input-xxlarge" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">推进计划：</label>

                            <div class="controls">
                                <textarea class="input-xxlarge" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="price">项目金额(元)：</label>

                            <div class="controls">
                                <input id="price" type="text">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label" for="taskName">付款方式：</label>

                            <div class="controls">
                                <input type="text">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">到款情况：</label>

                            <div class="controls">
                                <select>
                                    <option>未到款</option>
                                    <option>已收前期款</option>
                                    <option>已全部到款</option>
                                </select>

                                <div class="input-prepend">
                                    <span class="add-on">已收</span>
                                    <input class="input-small" type="text">
                                </div>
                                <div class="input-prepend">
                                    <span class="add-on">还有</span>
                                    <input class="input-small" type="text">
                                </div>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">到款情况：</label>

                            <div class="controls">
                                <select>
                                    <option>未开票</option>
                                    <option>已开票</option>
                                    <option>已出具到账证明</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="tab-pane fade" id="attachment">
                    <table class="table">
                        <colgroup>
                            <col style="width: 400px;">
                            <col style="width: 100px;">
                            <col style="width: 140px;">
                        </colgroup>
                        <tbody>
                        <tr>
                            <td><a href="#">咨询策划中心任务管理系统--需求分析.docx</a></td>
                            <td>上传用户</td>
                            <td>2013-8-22 10:20</td>
                        </tr>
                        <tr>
                            <td><a href="#">咨询策划中心任务管理系统--需求分析.docx</a></td>
                            <td>上传用户</td>
                            <td>2013-8-22 10:20</td>
                        </tr>
                        <tr>
                            <td><a href="#">咨询策划中心任务管理系统--需求分析.docx</a></td>
                            <td>上传用户</td>
                            <td>2013-8-22 10:20</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="tab-pane fade" id="comment">
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<div class="tab-pane fade" id="nodeList"></div>
</div>
</div>
</div>
</div>
<script>

    $(document).ready(function () {
        $('input').iCheck({
            checkboxClass: 'icheckbox_minimal'
        });
        $(".form_datetime").datetimepicker({
            format: "yyyy-mm-dd",
            autoclose: true,
            pickerPosition: "bottom-left",
            minView: "month",
            language: "zh-CN",
            todayBtn: true
        });
    });

    //生成展示数据
    function loadTasks() {
        var daySpans = [-1, 0, 0, 3, 3, 5, 7, 10, 15, 26, 30, 31, 32, 38, 40, 80, 100, 130, 400, 430],
                status = [1, 0, 1, 1, 3, 1, 1, 1, 2, 1, 1, 1 , 1, 1, 1, 1, 1, 1, 1, 1, 1, 1 ],
                data = [],
                now;
        for (var i = 0; i < daySpans.length; i++) {
            now = new Date();
            now.setDate(now.getDate() + daySpans[i]);
            data.push(new taskViewModel({
                Deadline: now,
                TaskName: "自动部署工具自动部署工具自动部署工具自动部署工具部署工具",
                PersonInCharge: "负责人",
                Creator: "创建人",
                CreateTime: new Date(2013, 5, 1),
                Status: status[i]
            }));
        }
        return data;
    }

    function formatDateString(date) {
        return date.getFullYear() + "年" + (date.getMonth() + 1) + "月" + date.getDate() + "日";
    }

    var filterLinkViewModel = function (field, name, selectListItems, defaultValue) {
        var self = this;
        self.field = field;
        self.name = name;
        self.selectListItems = selectListItems;
        self.value = ko.observable(defaultValue);
        self.select = function (data) {
            self.value(data.value);
        };
        self.clear = function () {
            self.value("");
        }
    };

    var taskListViewModel = function () {
        var self = this;
        self.filterLinks = ko.observableArray([
            new filterLinkViewModel("Status", "任务状态", [
                {value: "1", name: "未完成"},
                {value: "2", name: "已完成"},
                {value: "3", name: "已取消"},
                {value: "4", name: "发布待审"},
                {value: "5", name: "完成待审"}
            ], "1"),
            new filterLinkViewModel("Deadline", "到期时间", [
                {value: "1", name: "三天内"},
                {value: "2", name: "一周内"},
                {value: "3", name: "一个月内"}
            ], "1"),
            new filterLinkViewModel("TaskType", "任务类型", [
                {value: "1", name: "我负责的"},
                {value: "2", name: "我参与的"}
            ], "")
        ]);
        self.list = ko.observableArray(loadTasks());
        self.paginationInfo = ko.observable(new paginationInfo(1, 20, 0));
    };

    var paginationInfo = function (pageIndex, pageSize, total) {
        var self = this;
        self.pageIndex = pageIndex;
        self.pageSize = pageSize;
        self.total = total;
    };

    var taskViewModel = function (task) {
                var self = this,
                        init = function (task) {
                            self.deadline = formatDateString(task.Deadline);
                            self.taskName = task.TaskName;
                            self.personInCharge = task.PersonInCharge;
                            self.creator = task.Creator;
                            self.createTime = formatDateString(task.CreateTime);
                            self.status = task.Status;
                            self.daySpanHtml = taskDaySpanHtml(task);
                        },

                        taskDaySpanHtml = function (task) {
                            if (task.Status == 1) {
                                var daySpan = parseInt((task.Deadline - new Date()) / 1000 / 60 / 60 / 24),
                                        daySpanStr = daySpan,
                                        daySpanClass,
                                        prefix = "";
                                if (daySpan < 0) {
                                    daySpanStr = -daySpan;
                                    daySpanClass = "timespan-expired";
                                    prefix = "<small>过期</small>";
                                }
                                else if (daySpan == 0) {
                                    daySpanStr = "今"
                                    daySpanClass = "timespan-day";
                                } else if (daySpan <= 3) {
                                    daySpanClass = "timespan-day";
                                } else if (daySpan <= 7) {
                                    daySpanClass = "timespan-week";
                                } else if (daySpan <= 30) {
                                    daySpanClass = "timespan-month";
                                } else {
                                    daySpanClass = "timespan";
                                }
                                return prefix + '<span class="' + daySpanClass + '">' + daySpanStr + '</span><small>天</small>';
                            }
                            else {
                                var statusName = "";
                                switch (task.Status) {
                                    case 0:
                                        statusName = "发布待审";
                                        break;
                                    case 2:
                                        statusName = "完成待审";
                                        break;
                                    case 3:
                                        statusName = "已完成";
                                        break;
                                }
                                return '<small class="text-info">' + statusName + '</small> ';
                            }
                        };
                init(task);
                return self;
            }
            ;


    var indexViewModel = function () {
        var self = this;
        self.taskList = new taskListViewModel();
        self.showEditView = function () {
            $("#list").hide();
            $("#edit").show();
        };
        self.showListView = function () {
            $("#list").show();
            $("#edit").hide();
        };
    };
    ko.applyBindings(new indexViewModel());

</script>
</body>
</html>